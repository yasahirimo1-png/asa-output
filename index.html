<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æœã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ</title>
<style>
body { font-family: sans-serif; text-align: center; padding: 20px; }
button { padding: 10px 20px; font-size: 16px; margin: 5px; }
input { padding: 8px; font-size: 16px; width: 80%; margin:5px;}
.hidden { display: none; }
#timer { font-size: 22px; font-weight: bold; color: red; margin-bottom:10px; }
</style>
</head>
<body>

<h2>æœã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ</h2>

<div id="addArea">
<h3>å•é¡Œã‚’è¿½åŠ </h3>
<input type="text" id="newQ" placeholder="å•é¡Œ">
<br>
<input type="text" id="newA" placeholder="ç­”ãˆ">
<br>
<button onclick="addProblem()">è¿½åŠ </button>
<p id="addMsg"></p>
</div>

<hr>

<div id="setup">
<label>ä»Šæ—¥ã®å•é¡Œæ•°: </label>
<input type="number" id="count" value="3"><br>
<button onclick="start()">é–‹å§‹</button>
</div>

<div id="quiz" class="hidden">
<div id="timer">æ®‹ã‚Š: 15ç§’</div>
<h3 id="question"></h3>
<input type="text" id="answerInput" placeholder="ç­”ãˆã‚’å…¥åŠ›">
<br>
<button onclick="submitAnswer()">å›ç­”</button>
<p id="feedback"></p>
</div>

<audio id="alarmSound" preload="auto">
<source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
</audio>

<script>

let problems = JSON.parse(localStorage.getItem("problems")) || [];

function saveProblems(){
localStorage.setItem("problems", JSON.stringify(problems));
}

function addProblem(){
let q = document.getElementById("newQ").value;
let a = document.getElementById("newA").value;

if(q && a){
problems.push({q:q,a:a});
saveProblems();
document.getElementById("addMsg").innerText="è¿½åŠ ã—ã¾ã—ãŸ";
document.getElementById("newQ").value="";
document.getElementById("newA").value="";
}else{
document.getElementById("addMsg").innerText="å…¥åŠ›ã—ã¦ãã ã•ã„";
}
}

let todaySet = [];
let current = null;
let timerInterval;
let timeLeft = 15;
let soundEnabled = false;

function normalize(text){
return text.trim().toLowerCase();
}

function start(){
if(problems.length === 0){
alert("å•é¡Œã‚’è¿½åŠ ã—ã¦ãã ã•ã„");
return;
}

/* ğŸ”¥ iPhoneéŸ³è¨±å¯å‡¦ç† */
let sound = document.getElementById("alarmSound");
sound.play().then(()=>{
sound.pause();
sound.currentTime = 0;
soundEnabled = true;
}).catch(()=>{
soundEnabled = false;
});

let count = parseInt(document.getElementById("count").value);
todaySet = problems.sort(()=>0.5-Math.random()).slice(0,count);
document.getElementById("setup").classList.add("hidden");
document.getElementById("addArea").classList.add("hidden");
document.getElementById("quiz").classList.remove("hidden");
nextQuestion();
}

function nextQuestion(){
if(todaySet.length === 0){
alert("å…¨å•æ­£è§£ï¼çµ‚äº†ï¼");
location.reload();
return;
}
current = todaySet[Math.floor(Math.random()*todaySet.length)];
document.getElementById("question").innerText = current.q;
document.getElementById("answerInput").value="";
document.getElementById("feedback").innerText="";
startTimer();
}

function submitAnswer(){
let userAns = normalize(document.getElementById("answerInput").value);
if(userAns === normalize(current.a)){
todaySet = todaySet.filter(p=>p!==current);
document.getElementById("feedback").innerText="æ­£è§£ï¼";
}else{
document.getElementById("feedback").innerText="ä¸æ­£è§£ã€‚æ­£è§£: "+current.a;
}
nextQuestion();
}

function startTimer(){
clearInterval(timerInterval);
timeLeft = 15;
updateTimerDisplay();

timerInterval = setInterval(()=>{
timeLeft--;
updateTimerDisplay();

if(timeLeft <= 0){
clearInterval(timerInterval);

if(soundEnabled){
let sound = document.getElementById("alarmSound");
sound.currentTime = 0;
sound.play();
}

alert("æ™‚é–“åˆ‡ã‚Œï¼ã‚¢ãƒ©ãƒ¼ãƒ ç™ºå‹•ï¼");
startTimer();
}

},1000);
}

function updateTimerDisplay(){
document.getElementById("timer").innerText = "æ®‹ã‚Š: " + timeLeft + "ç§’";
}

</script>

</body>
</html>
