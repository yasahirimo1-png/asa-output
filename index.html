<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>朝アウトプット</title>
<style>
body { font-family: sans-serif; text-align: center; padding: 20px; }
button { padding: 10px 20px; font-size: 16px; margin: 5px; }
input { padding: 8px; font-size: 16px; width: 80%; margin:5px;}
.hidden { display: none; }
#timer { font-size: 20px; font-weight: bold; color: red; }
</style>
</head>
<body>

<h2>朝アウトプット</h2>

<div id="addArea">
<h3>問題を追加</h3>
<input type="text" id="newQ" placeholder="問題">
<br>
<input type="text" id="newA" placeholder="答え">
<br>
<button onclick="addProblem()">追加</button>
<p id="addMsg"></p>
</div>

<hr>

<div id="setup">
<label>今日の問題数: </label>
<input type="number" id="count" value="3"><br>
<button onclick="start()">開始</button>
</div>

<div id="quiz" class="hidden">
<div id="timer">残り: 15秒</div>
<h3 id="question"></h3>
<input type="text" id="answerInput" placeholder="答えを入力">
<br>
<button onclick="submitAnswer()">回答</button>
<p id="feedback"></p>
</div>

<audio id="alarmSound">
<source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
</audio>

<script>

let problems = JSON.parse(localStorage.getItem("problems")) || [];

function saveProblems(){
localStorage.setItem("problems", JSON.stringify(problems));
}

function addProblem(){
let q = document.getElementById("newQ").value;
let a = document.getElementById("newA").value;

if(q && a){
problems.push({q:q,a:a});
saveProblems();
document.getElementById("addMsg").innerText="追加しました";
document.getElementById("newQ").value="";
document.getElementById("newA").value="";
}else{
document.getElementById("addMsg").innerText="入力してください";
}
}

let todaySet = [];
let current = null;
let timerInterval;
let timeLeft = 15;

function normalize(text){
return text.trim().toLowerCase();
}

function start(){
if(problems.length === 0){
alert("問題を追加してください");
return;
}
let count = parseInt(document.getElementById("count").value);
todaySet = problems.sort(()=>0.5-Math.random()).slice(0,count);
document.getElementById("setup").classList.add("hidden");
document.getElementById("addArea").classList.add("hidden");
document.getElementById("quiz").classList.remove("hidden");
nextQuestion();
}

function nextQuestion(){
if(todaySet.length === 0){
alert("全問正解！終了！");
location.reload();
return;
}
current = todaySet[Math.floor(Math.random()*todaySet.length)];
document.getElementById("question").innerText = current.q;
document.getElementById("answerInput").value="";
document.getElementById("feedback").innerText="";
startTimer();
}

function submitAnswer(){
let userAns = normalize(document.getElementById("answerInput").value);
if(userAns === normalize(current.a)){
todaySet = todaySet.filter(p=>p!==current);
document.getElementById("feedback").innerText="正解！";
}else{
document.getElementById("feedback").innerText="不正解。正解: "+current.a;
}
nextQuestion();
}

function startTimer(){
clearInterval(timerInterval);
timeLeft = 15;
updateTimerDisplay();

timerInterval = setInterval(()=>{
timeLeft--;
updateTimerDisplay();

if(timeLeft <= 0){
clearInterval(timerInterval);
document.getElementById("alarmSound").play();
alert("時間切れ！アラーム発動！");
startTimer();
}
},1000);
}

function updateTimerDisplay(){
document.getElementById("timer").innerText = "残り: " + timeLeft + "秒";
}

</script>

</body>
</html>
